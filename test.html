<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Results</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body {font-family:'Inter', sans-serif; margin:0; padding:2rem; background:#f9f9f9; color:#333;}
    header {text-align:center; margin-bottom:2rem;}
    nav {text-align:center; margin-bottom:1rem;}
    nav a {margin-right:1rem; color:#c62828; text-decoration:none;}
    nav a:hover {text-decoration:underline;}
    table {width:100%; border-collapse:collapse; margin-bottom:1rem; background:#fff;}
    th, td {border:1px solid #ddd; padding:0.5rem; text-align:center;}
    th {background:#ececec;}
  </style>
</head>
<body>
  <header>
    <h1>Patient Test Data</h1>
  </header>
  <nav>
    <a href="device.html">Main Page</a>
  </nav>
  <main>
    <table id="resultsTable">
      <thead>
        <tr><th>Sample</th><th>Hemoglobin (g/dl)</th><th>Ferritin (ng/ml)</th><th>Serum Iron (mcg/dl)</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <p>Measured hemoglobin value is 12.6 g/dl.</p>
    <p>Demo Ferritin value is 223 ng/ml.</p>
    <p>Demo serum iron value is 63 mcg/dl.</p>
    <table id="analysisTable">
      <thead>
        <tr><th>Parameter</th><th>Status</th><th>Most Likely Diagnosis</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>
  <script>
    const patient = JSON.parse(localStorage.getItem('patient') || '{}');
    const hb = 12.6;
    const ferritin = 223;
    const iron = 63;

    function getStatus(value, range){
      const [low, high] = range;
      if(value < low) return 'Decreased';
      if(value > high) return 'Increased';
      return 'Normal';
    }

    function analyse(){
      let ranges;
      if(patient.sex === 'male'){
        ranges = {hb:[13.5,17.5], ferritin:[20,500], iron:[65,176]};
      }else{
        ranges = {hb:[12.0,15.5], ferritin:[20,200], iron:[50,170]};
      }
      const tbody = document.querySelector('#analysisTable tbody');
      tbody.innerHTML = '';
      tbody.appendChild(makeRow('Hemoglobin', getStatus(hb, ranges.hb), 'Iron Deficiency Anaemia'));
      tbody.appendChild(makeRow('Ferritin', getStatus(ferritin, ranges.ferritin), 'Iron Deficiency Anaemia'));
      tbody.appendChild(makeRow('Iron', getStatus(iron, ranges.iron), 'Iron Deficiency Anaemia'));
    }

    function makeRow(param, status, diagnosis){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${param}</td><td>${status}</td><td>${diagnosis}</td>`;
      return tr;
    }

    function fetchData(){
      const url = 'YOUR_WEB_APP_URL';
      fetch(url, {method:'POST'})
        .then(r => r.json())
        .then(data => {
          const tbody = document.querySelector('#resultsTable tbody');
          tbody.innerHTML = '';
          data.forEach((item, i) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${i+1}</td><td>${item.hemoglobin}</td><td>${item.ferritin}</td><td>${item.iron}</td>`;
            tbody.appendChild(tr);
          });
        });
    }

    analyse();
    //fetchData(); // Uncomment when web app url is set
  </script>
</body>
</html>
